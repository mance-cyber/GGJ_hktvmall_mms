# GoGoJap 抓取系統說明文件

> 版本：1.0
> 更新日期：2026-01-18
> 作者：開發團隊

---

## 1. 系統概述

GoGoJap 是一個專為 HKTVmall 商家設計的 AI 驅動營運管理系統。系統需要通過網頁抓取（Web Scraping）獲取關鍵業務數據，以實現智能化的商品管理和 SEO 優化功能。

---

## 2. 為什麼需要抓取？

### 2.1 HKTVmall 平台的數據限制

HKTVmall 作為香港最大的網上購物平台之一，其商家後台（Merchant Portal）提供的數據有以下限制：

| 數據類型 | API 可用性 | 說明 |
|---------|-----------|------|
| 訂單數據 | ✓ 有 API | 可直接獲取 |
| 庫存數據 | ✓ 有 API | 可直接獲取 |
| **商品展示數據** | ✗ 無 API | 需要抓取 |
| **搜尋排名** | ✗ 無 API | 需要抓取 |
| **競品價格** | ✗ 無 API | 需要抓取 |
| **SEO 表現** | ✗ 無 API | 需要抓取 |

### 2.2 商業價值

抓取數據能夠為商家提供以下核心價值：

```
┌─────────────────────────────────────────────────────────────┐
│                     商業價值金字塔                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌───────────────┐                        │
│                    │   銷售增長    │                        │
│                    │   提升 GMV    │                        │
│                    └───────┬───────┘                        │
│                            │                                │
│              ┌─────────────┴─────────────┐                  │
│              │                           │                  │
│       ┌──────┴──────┐             ┌──────┴──────┐          │
│       │  SEO 優化   │             │  競品分析   │          │
│       │  提升曝光   │             │  價格策略   │          │
│       └──────┬──────┘             └──────┬──────┘          │
│              │                           │                  │
│    ┌─────────┴───────────────────────────┴─────────┐       │
│    │                                               │       │
│    │              數據抓取層                        │       │
│    │   (商品數據、排名數據、競品數據、價格數據)      │       │
│    │                                               │       │
│    └───────────────────────────────────────────────┘       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 抓取用途詳解

### 3.1 商品數據抓取

**目的：** 獲取商品在 HKTVmall 前台的實際展示信息

**抓取內容：**
- 商品標題（實際顯示版本）
- 當前售價與原價
- 折扣百分比
- 庫存狀態（有貨/缺貨/預購）
- 評分與評論數
- 商品圖片
- 促銷標籤

**使用場景：**
```
場景 1: 價格監控
─────────────────────────────────────────
商家設定商品售價為 HK$99，但想確認：
  - 前台是否正確顯示？
  - 折扣標籤是否生效？
  - 與競品價格差距如何？

→ 系統每日抓取並對比，發現異常即時通知
```

```
場景 2: 商品信息同步
─────────────────────────────────────────
商家在後台更新了商品描述，但想確認：
  - 更新是否已同步到前台？
  - SEO 關鍵詞是否正確出現？

→ 系統抓取前台頁面驗證更新狀態
```

### 3.2 SEO 排名追蹤

**目的：** 監控商品在 HKTVmall 站內搜尋和 Google 的排名位置

**抓取內容：**

| 來源 | 抓取數據 |
|-----|---------|
| HKTVmall 站內搜尋 | 關鍵詞搜尋結果排名、總結果數 |
| Google 香港 | SERP 排名、SERP 特徵（精選摘要、購物廣告等） |

**為什麼重要：**

```
HKTVmall 搜尋排名 vs 銷售轉化
───────────────────────────────────────────────────────
排名位置    │ 點擊率估算  │ 對銷售的影響
───────────────────────────────────────────────────────
第 1-3 名   │ 30-50%     │ 高曝光 → 高轉化
第 4-10 名  │ 10-20%     │ 中等曝光
第 11-20 名 │ 3-8%       │ 低曝光
第 20+ 名   │ <2%        │ 幾乎無曝光
───────────────────────────────────────────────────────

結論：排名每下降 5 位，點擊率可能下降 30-50%
```

**使用場景：**
```
場景: SEO 排名警報
─────────────────────────────────────────
商家的熱門關鍵詞「日本零食」排名：
  - 上週：第 3 名
  - 本週：第 12 名 ⚠️ 下降 9 位

→ 系統即時發送警報，建議優化商品標題和描述
```

### 3.3 競品監控

**目的：** 追蹤競爭對手的價格和促銷策略

**抓取內容：**
- 競品價格變動
- 競品促銷活動
- 競品排名位置
- 競品新品上架

**使用場景：**
```
場景: 競品價格追蹤
─────────────────────────────────────────
商家銷售「韓國拉麵」，設定追蹤 3 個競品：

競品 A: HK$28 → HK$25 (降價 10%)
競品 B: HK$32 (維持)
競品 C: HK$30 → HK$22 (限時優惠)

→ 系統通知商家，建議調整定價策略
```

---

## 4. 技術實現

### 4.1 抓取架構

```
┌─────────────────────────────────────────────────────────────┐
│                      抓取系統架構                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐   │
│  │  Firecrawl  │     │   Scrape    │     │    SEO      │   │
│  │  Connector  │────▶│  Executor   │────▶│  Ranking    │   │
│  │             │     │             │     │  Service    │   │
│  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘   │
│         │                   │                   │           │
│         │    ┌──────────────┴──────────────┐    │           │
│         │    │                             │    │           │
│         ▼    ▼                             ▼    ▼           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Firecrawl API                     │   │
│  │  (雲端渲染引擎，處理 JavaScript SPA)                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                                │
│                            ▼                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              目標網站                                │   │
│  │  • HKTVmall (JavaScript SPA)                        │   │
│  │  • Google Hong Kong                                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 為什麼選擇 Firecrawl？

| 需求 | 傳統抓取 | Firecrawl |
|-----|---------|-----------|
| JavaScript 渲染 | 需要 Selenium/Playwright | 雲端自動處理 |
| 反爬蟲繞過 | 需要自行處理 | 內建處理 |
| 結構化提取 | 需要寫解析器 | JSON Mode 自動提取 |
| 擴展性 | 需要管理伺服器 | 無伺服器，按需擴展 |
| 成本 | 伺服器 + 維護 | 按抓取量付費 |

### 4.3 抓取頻率

| 數據類型 | 抓取頻率 | 原因 |
|---------|---------|------|
| SEO 排名 | 每日 1 次 | 排名變化緩慢 |
| 商品價格 | 每 6 小時 | 價格可能隨促銷變動 |
| 競品監控 | 每日 1-2 次 | 平衡成本與時效 |
| 庫存狀態 | 按需抓取 | 只在需要時獲取 |

---

## 5. 合規與道德考量

### 5.1 合規措施

- **遵守 robots.txt**：檢查並遵守目標網站的爬蟲協議
- **請求頻率限制**：控制抓取速度，避免對目標網站造成負擔
- **用戶授權**：只抓取商家授權監控的數據
- **數據使用範圍**：抓取數據僅用於商家自身營運優化

### 5.2 速率限制配置

```python
# 當前系統配置
RATE_LIMITS = {
    "hktvmall": {
        "requests_per_minute": 30,      # 每分鐘最多 30 次請求
        "request_delay_seconds": 2.0,   # 每次請求間隔 2 秒
    },
    "google": {
        "requests_per_minute": 20,
        "request_delay_seconds": 2.5,
    }
}
```

---

## 6. 數據流程圖

```
用戶操作                    系統處理                      輸出
─────────────────────────────────────────────────────────────────

┌───────────────┐
│ 商家登入系統   │
└───────┬───────┘
        │
        ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│ 設定追蹤關鍵詞 │────▶│ 排程抓取任務   │────▶│ 排名數據入庫   │
└───────────────┘     └───────────────┘     └───────────────┘
                                                    │
        ┌───────────────────────────────────────────┘
        │
        ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│ 查看儀表板    │◀────│ 數據可視化    │◀────│ 趨勢分析      │
└───────────────┘     └───────────────┘     └───────────────┘
        │
        ▼
┌───────────────┐     ┌───────────────┐
│ 收到排名警報   │◀────│ 異常檢測      │
└───────────────┘     └───────────────┘
        │
        ▼
┌───────────────┐
│ 採取優化行動   │
└───────────────┘
```

---

## 7. 總結

### 為什麼需要抓取？

1. **填補數據缺口** - HKTVmall 不提供 SEO 排名、競品價格等關鍵數據的 API
2. **賦能商家決策** - 讓商家了解自己商品的真實市場表現
3. **自動化監控** - 取代人工逐個搜尋查看的低效方式
4. **競爭優勢** - 及時掌握市場變化，快速響應

### 商業效益預期

| 指標 | 預期改善 |
|-----|---------|
| SEO 排名 | 平均提升 20-30% |
| 商品曝光 | 增加 15-25% |
| 價格競爭力 | 優化定價響應時間從「天」到「小時」|
| 運營效率 | 減少 50% 手動監控時間 |

---

## 附錄 A: 相關文件

- `backend/app/connectors/firecrawl.py` - Firecrawl 連接器
- `backend/app/connectors/hktv_scraper.py` - HKTVmall 專用抓取器
- `backend/app/services/seo_ranking_service.py` - SEO 排名服務
- `backend/app/services/scrape_executor.py` - 抓取執行器

## 附錄 B: 術語表

| 術語 | 定義 |
|-----|------|
| Web Scraping | 從網頁自動提取數據的技術 |
| SERP | Search Engine Results Page，搜尋引擎結果頁面 |
| SEO | Search Engine Optimization，搜尋引擎優化 |
| SPA | Single Page Application，單頁應用程式 |
| JSON Mode | Firecrawl 的結構化數據提取功能 |
